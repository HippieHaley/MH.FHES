<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Note Reformatter (Auto Copy)</title>
<style>
  body {
    font-family: Arial, sans-serif;
    max-width: 800px;
    margin: 20px auto;
    background-color: #acdbf9;
    padding: 20px;
  }
  textarea {
    width: 100%;
    height: 200px;
    padding: 10px;
    font-family: monospace;
    font-size: 1rem;
    border: 2px solid #333;
    border-radius: 8px;
    margin-bottom: 20px;
  }
  button {
    padding: 10px 20px;
    font-weight: bold;
    border: 2px solid #333;
    border-radius: 20px;
    background-color: #f8c9f9;
    cursor: pointer;
    transition: background-color 0.2s;
  }
  button:hover {
    background-color: #e8b3e8;
  }
  pre {
    white-space: pre-wrap;
    background-color: #f6f6f6;
    padding: 20px;
    border: 2px solid #333;
    border-radius: 8px;
    min-height: 200px;
    font-family: monospace;
    overflow-x: auto;
  }
  .notification {
    margin-top: 10px;
    padding: 10px;
    background-color: #d4edda;
    border: 2px solid #155724;
    border-radius: 8px;
    color: #155724;
    font-weight: bold;
    display: none;
    text-align: center;
  }
</style>
</head>
<body>

<h1>Note Reformatter</h1>

<textarea id="input" placeholder="Type or paste your note here..."></textarea>
<br>
<button id="format">Format & Copy</button>

<pre id="output"></pre>

<div id="notification" class="notification">Copied to clipboard!</div>

<script>
document.getElementById('format').addEventListener('click', () => {
  const input = document.getElementById('input').value;
  
  const lines = input
    .replace(/;/g, '') // Remove semicolons
    .split(/\r?\n/);    // Split at line breaks

  const today = new Date();
  const threeMonthsFromNow = new Date();
  threeMonthsFromNow.setMonth(today.getMonth() + 3);

  const wrappedLines = lines
    .filter(line => line.trim() !== '') // Ignore empty lines
    .map(line => {
      const trimmed = line.trim();

      // Split into label and rest
      const parts = trimmed.split('Due:');
      if (parts.length === 2) {
        const label = `<b>${parts[0].trim()} Due:</b>`;
        let dateAndExtra = parts[1].trim();

        // Try to pull out the first date in the text
        const dateMatch = dateAndExtra.match(/(\d{1,2}\/\d{4}|\d{1,2}\/\d{1,2}\/\d{2,4}|\b\w+\s\d{4}\b)/);
        if (dateMatch) {
          const dateText = dateMatch[1];
          let parsedDate = null;

          if (/\d{1,2}\/\d{4}/.test(dateText)) {
            // format M/YYYY or MM/YYYY
            const parts = dateText.split('/');
            const month = parseInt(parts[0]) - 1; // JS months are 0-indexed
            const year = parseInt(parts[1]);
            parsedDate = new Date(year, month, 1); // Assume day 1
          } else if (dateText.includes('/')) {
            // format MM/DD/YYYY or MM/DD/YY
            const parts = dateText.split('/');
            const month = parseInt(parts[0]) - 1;
            const day = parseInt(parts[1]);
            let year = parseInt(parts[2]);
            if (year < 100) { year += 2000; }
            parsedDate = new Date(year, month, day);
          } else {
            // format Month YYYY
            parsedDate = new Date(dateText);
          }

          if (parsedDate instanceof Date && !isNaN(parsedDate)) {
            const dateMonth = parsedDate.getMonth();
            const dateYear = parsedDate.getFullYear();

            const currentMonth = today.getMonth();
            const currentYear = today.getFullYear();

            const currentTotalMonths = currentYear * 12 + currentMonth;
            const dateTotalMonths = dateYear * 12 + dateMonth;
            const threeMonthsLaterTotal = threeMonthsFromNow.getFullYear() * 12 + threeMonthsFromNow.getMonth();

            if (dateTotalMonths < currentTotalMonths) {
              // Past month
              dateAndExtra = dateAndExtra.replace(dateText, `<span style="color:red;">${dateText}</span>`);
            } else if (dateTotalMonths <= threeMonthsLaterTotal) {
              // This month or next 3 months
              dateAndExtra = dateAndExtra.replace(dateText, `<span style="color:orange;">${dateText}</span>`);
            }
          }
        }

        return `<p>${label} ${dateAndExtra}</p>`;
      } else {
        // fallback if something doesn't match the expected pattern
        return `<p>${trimmed}</p>`;
      }
    });

  const result = wrappedLines.join('\n');
  document.getElementById('output').textContent = result;

  // Auto-copy to clipboard
  navigator.clipboard.writeText(result)
    .then(() => {
      const notif = document.getElementById('notification');
      notif.style.display = 'block';
      setTimeout(() => {
        notif.style.display = 'none';
      }, 2000);
    })
    .catch(err => {
      console.error('Could not copy text: ', err);
    });
});
</script>
</body>
</html>
