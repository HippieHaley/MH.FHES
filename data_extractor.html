<!-- data_extractor.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Data Extractor</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
  <h2>Excel Data Extractor</h2>
  <input type="file" id="excelFile" accept=".xlsx, .xls" />

  <script>
    document.getElementById('excelFile').addEventListener('change', handleFile, false);

    function handleFile(event) {
      const file = event.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function(e) {
        // Parse Excel
        const data = new Uint8Array(e.target.result);
        const workbook = XLSX.read(data, { type: 'array' });
        const sheetName = workbook.SheetNames[0];
        const worksheet = workbook.Sheets[sheetName];
        const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });

        // Now we can transform jsonData into our "invoiceData" structure
        // For example, let's say row 0 is headers, row 1..n are data
        const lineItems = [];

        for (let i = 1; i < jsonData.length; i++) {
          const row = jsonData[i];
          // row[0] = claimNumber, row[1] = serviceDate, etc.
          lineItems.push({
            claimNumber: row[0],
            serviceDate: row[1],
            procedure: row[2],
            units: row[3],
            lineTotal: row[4],
            patientPaid: row[5],
            insurancePaid: row[6],
            adjustments: row[7],
            balance: row[8],
            payment: row[9]
          });
        }

        // Build an object that matches what invoice_template.html expects
        const invoiceData = {
          amountDue: "$40.00",        // Hard-coded or extracted from the Excel file
          clientName: "Hale, Savannah (0003621)",
          statementDate: "3/18/2025",
          disclaimer: "Charges/adjustments made after statement date may not appear...",
          lineItems: lineItems
        };

        // Store in localStorage as a JSON string
        localStorage.setItem('invoiceData', JSON.stringify(invoiceData));

        // (Optional) Auto-open the template in a new tab
        window.open('invoice_template.html', '_blank');
      };
      reader.readAsArrayBuffer(file);
    }
  </script>
</body>
</html>
